angular.module("helpme",["ionic","restangular","helpme.controllers","helpme.services","helpme.directives","helpme.filters","ngCordova","igTruncate"]).run(function(e,t,o,r){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),window.plugin.notification.local.onclick=function(e,o,r){alert(JSON.parse(r).from),t.$broadcast("notification.local.click",{id:e,state:o,json:JSON.parse(r)})}}),t.$on("$stateChangeStart",function(e,t){t.data.requiresLogin&&!o.authenticated&&(e.preventDefault(),r.transitionTo("login"))})}).config(function(e,t,o,r,a){o.setBaseUrl(ENDPOINT),o.setFullResponse(!0),r.setIo(io),e.state("root",{url:"/",controller:function(e){e.transitionTo("login")},data:{requiresLogin:!1}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginCtrl",data:{requiresLogin:!1}}).state("homepage",{url:"/home","abstract":!0,controller:"HomepageCtrl",templateUrl:"templates/menu.html",data:{requiresLogin:!0}}).state("homepage.proveedores",{url:"/proveedores",views:{menuContent:{templateUrl:"templates/proveedores.html",controller:"ProveedoresCtrl"}},data:{requiresLogin:!0}}).state("homepage.messages",{url:"/proveedores/messages",views:{menuContent:{templateUrl:"../templates/proveedores/mensajes.html",controller:"MessagesCtrl"}},data:{requiresLogin:!0}}).state("homepage.chat",{url:"/proveedores/chat/:id",views:{menuContent:{templateUrl:"templates/proveedores/show.html",controller:"ChatCtrl"}},data:{requiresLogin:!0}}).state("homepage.profile",{url:"/profile/:id",views:{menuContent:{templateUrl:"templates/proveedores/profile/profile.html",controller:"ProfileCtrl"}}}),t.otherwise("/"),a.interceptors.push("TokenInterceptor")}),ionic.Platform.ready(function(){window.plugin.notification.local.onclick=function(e,t,o){"com.help.upplus4.notification.message"==e&&$scope.apply(function(){$state.transitionTo("homepage.chat",{id:o.from})})}});
var controllers;controllers=angular.module("helpme.controllers",[]),controllers.controller("LoginCtrl",["$scope","$state","SessionService","$ionicPopup","LoadingService",function(o,e,t,n,s){return o.loginData={},o.showBar=!1,o.login=function(o){s.show("Comprobando credenciales..."),t.login(o,function(o){s.hide(),200==o.status?e.transitionTo("homepage.proveedores"):n.alert({title:'<i class="icon ion-alert-circled"></i>  Usuario o contraseña inválida',template:"Compruebe las credenciales"})})}}]),controllers.controller("MainCtrl",function(o,e,t,n){o.messages=[],o.messageCount=0,o.user={},o.messages=[],o.total_users=0,o.incommingMessages=[],o.users=[],o.useGPS={status:!1};o.goToMessages=function(){e.transitionTo("messages")},o.$on("notification.local.click",function(t,n){"com.help.upplus4.notification.message"==n.id&&o.apply(function(){e.transitionTo("homepage.chat",{id:n.json.from})})}),o.$on("user.messaged",function(e,n){t.add({id:"com.help.upplus4.notification.message",title:"Mensaje recibido",message:n.data.from.name+": "+n.data.message,json:{from:n.data.from.userid}}).then(function(o){console.log(o)}),o.incommingMessages.push(n)}),o.goToProfile=function(){e.transitionTo("homepage.profile",{id:n.user.id})},o.$watch("useGPS.status",function(o,e){e&&console.log("activado GPS")})}),controllers.controller("HomepageCtrl",function(){}),controllers.controller("ProveedoresCtrl",["$scope","socket","$window","$ionicActionSheet","$state",function(o,e,t,n,s){o.$on("user.added",function(e,t){o.$apply(function(){o.users.push(t)})}),o.$on("user.destroyed",function(e,t){var n=_.findIndex(o.users,function(o){return o.id==t});o.$apply(function(){o.users.splice(n,1)})}),e.emit("get","/sessionuser/list",{headers:{Authorization:t.sessionStorage.token}},function(e){o.$apply(function(){o.users=e})}),o.openSheet=function(o){n.show({buttons:[{text:'<i class="icon ion-person"></i> Ver perfil'},{text:'<i class="icon ion-chatbox"></i> Enviar mensaje'}],titleText:"Acciones",buttonClicked:function(e){1==e&&s.transitionTo("homepage.chat",{id:o}),0==e&&s.transitionTo("homepage.profile",{id:o})}})}}]),controllers.controller("ChatCtrl",["$scope","$rootScope","$stateParams","socket","$cordovaLocalNotification","$window","SessionService","$ionicScrollDelegate","$ionicModal",function(o,e,t,n,s,i,r,a,c){var l=t.id;n.socket.get("/conversations/"+r.user.id+"/"+l,{headers:{Authorization:i.sessionStorage.token}},function(e){o.$apply(function(){a.$getByHandle("chat").scrollBottom(),o.messages=e})}),n.socket.get("/sessionuser/"+l,{headers:{Authorization:i.sessionStorage.token}},function(e){o.user=e}),o.send=function(e,t){o.message="",n.socket.post("/sessionuser/message/",{to:l,message:e,type:t,headers:{Authorization:i.sessionStorage.token}},function(e){o.$apply(function(){o.messages.push(e),a.$getByHandle("chat").scrollBottom()})})},o.$on("user.messaged",function(e,t){t.data.from.userid==l?o.$apply(function(){o.messages.push(t.data),a.$getByHandle("chat").scrollBottom()}):s.add({id:"com.help.upplus4.notification.message",title:"Mensaje recibido",message:t.data.from.name+": "+t.data.message,json:{to:t.data.from.userid}}).then(function(o){console.log(o)})}),o.receivePicture=function(e){o.send(e,"image")},o.openImage=function(e){o.imageTap=e,c.fromTemplateUrl("templates/proveedores/imageModal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()}),o.closeModal=function(){o.modal.hide()}}}]),controllers.controller("NotificationsCtrl",["$scope","$state","$ionicPopover",function(o,e,t){o.goToChat=function(t){e.transitionTo("homepage.chat",{id:t}),o.popover.hide()},t.fromTemplateUrl("popover.html",{scope:o}).then(function(e){o.popover=e}),o.openPopover=function(e){o.popover.show(e)}}]),controllers.controller("ProfileCtrl",["$scope","$stateParams","Restangular","SessionService",function(o,e,t,n){t.one("user",e.id).get().then(function(e){o.user=e.data}),o.getInclude=function(){return parseInt(e.id)!==n.user.id?"templates/proveedores/profile/_profile_footer.html":"templates/proveedores/profile/_profile_footer_mine.html"},o.edit=function(){o.transitionTo("homepage.perfil.edit")}}]),controllers.controller("MessagesCtrl",["$scope","socket",function(){}]);
angular.module("helpme.directives",[]).directive("helpmeNotifications",["$ionicPopover","$state",function(e,o){return{restrict:"E",scope:{messages:"="},replace:!0,template:'<button class="button button-clear button-stable" ng-click="open($event)"><i ng-class="{\'icon ion-chatbubbles\': hasMessages(), \'icon ion-chatbubble\': !hasMessages()}">{{ count }}</i></button>',link:function(t){t.count=0,t.hasMessages=function(){return t.count>0},t.$on("user.messaged",function(){console.log(t.messages),t.$apply(function(){t.count++})}),e.fromTemplateUrl("popover.html",{scope:t}).then(function(e){t.popover=e}),t.open=function(e){t.popover.show(e)},t.goToChat=function(e){_.remove(t.messages,function(o){return o.data.id==e.data.id}),t.popover.hide(),o.transitionTo("homepage.chat",{id:e.data.from.userid})}}}}]).directive("helpmeShare",["$ionicPopover","$cordovaCamera",function(e,o){return{restrict:"A",scope:{sendPicture:"&"},template:'<button class="button button-icon icon ion-share" ng-click="openPopover($event)"></button>',replace:!0,link:function(t){var n={quality:75,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!1};e.fromTemplateUrl("templates/proveedores/shareMenu.html",{scope:t}).then(function(e){t.popover=e}),t.openPopover=function(e){t.popover.show(e)},t.openCamera=function(){o.getPicture(n).then(function(e){t.popover.hide(),t.sendPicture({imageData:e})})}}}}]);
angular.module("helpme.filters",[]).filter("default",function(){return function(e,n){var r="No indica";return e?e:n||r}});
angular.module("starter",["ionic","starter.controllers"]).run(function(t){t.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}).config(function(t,l){t.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"AppCtrl"}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"templates/search.html"}}}).state("app.browse",{url:"/browse",views:{menuContent:{templateUrl:"templates/browse.html"}}}).state("app.playlists",{url:"/playlists",views:{menuContent:{templateUrl:"templates/playlists.html",controller:"PlaylistsCtrl"}}}).state("app.single",{url:"/playlists/:playlistId",views:{menuContent:{templateUrl:"templates/playlist.html",controller:"PlaylistCtrl"}}}),l.otherwise("/app/playlists")}),angular.module("starter.controllers",[]).controller("AppCtrl",function(t,l,e){t.loginData={},l.fromTemplateUrl("templates/login.html",{scope:t}).then(function(l){t.modal=l}),t.closeLogin=function(){t.modal.hide()},t.login=function(){t.modal.show()},t.doLogin=function(){console.log("Doing login",t.loginData),e(function(){t.closeLogin()},1e3)}}).controller("PlaylistsCtrl",function(t){t.playlists=[{title:"Reggae",id:1},{title:"Rock nacional",id:2},{title:"Dubstep",id:3},{title:"Indie",id:4},{title:"Rap",id:5},{title:"Cowbell",id:6}]}).controller("PlaylistCtrl",function(){});
function SocketIO(e,t,n){this.io=e,this.socket=null,this.users=[],this.pendingRequests=[],t.users=[],t.usuario={},this.emit=function(e,t,s,o){var i=this;"string"==typeof o&&(e=o,o=null),"function"==typeof s&&(o=s,s={}),null==this.socket?(this.socket=this.io.connect(ENDPOINT,{query:"token="+n.token}),this.socket.on("connect",function(){i.bindEvents(),i.socket[e](t,s,function(e){return o(e)})})):this.socket[e](t,s,function(e){return o(e)})},this.bindEvents=function(){var e=this;e.socket.on("sessionuser",function(e){switch(console.log("evento!",e),e.verb){case"updated":_.each(t.users,function(n){n.id==e.id&&t.$apply(function(){n.name=e.data.name})});break;case"created":t.users.push(e.data),t.$broadcast("user.added",e.data);break;case"destroyed":t.$broadcast("user.destroyed",e.id);break;case"messaged":t.$broadcast("user.messaged",e)}})}}angular.module("helpme.services",[]).factory("SessionService",function(e,t){return{authenticated:!1,username:null,id:null,user:{},token:null,login:function(n,s){var o=this;e.all("user").all("login").post(n).then(function(e){return t.sessionStorage.token=o.token=e.data.token,o.authenticated=!0,o.user=e.data,s(e)},function(e){return s(e)})}}}).provider("socket",function(){this.setIo=function(e){this.io=e},this.$get=["$rootScope","SessionService",function(e,t){return new SocketIO(this.io,e,t)}]}).factory("TokenInterceptor",function(e,t){return{request:function(e){return e.headers=e.headers||{},t.sessionStorage.token&&(e.headers.Authorization=t.sessionStorage.token),e},response:function(t){return t||e.when(t)}}}).factory("LoadingService",function(e){return{show:function(t){e.show({template:'<i class="icon ion-loading-c"></i> '+t})},hide:function(){e.hide()}}});
